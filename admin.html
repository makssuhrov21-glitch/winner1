<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>Admin ‚Äî Winner Znamyanka</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    .top{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:#111;color:#fff}
    .top h1{margin:0;font-size:20px}
    .actions button{margin-left:6px}
    .wrap{display:grid;grid-template-columns:1.1fr 1fr;gap:18px;padding:18px;background:#f6f7fb;min-height:100vh}
    .form,.list{background:#fff;border:1px solid #eee;border-radius:12px;padding:16px}
    h2,h3,h4{margin:8px 0}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .grid label{display:flex;flex-direction:column;font-size:14px;gap:6px}
    input,textarea,select{padding:10px;border:1px solid #ddd;border-radius:10px;background:#fff}
    .images{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:8px;align-items:center}
    .images input{width:100%}
    .specs{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btns{display:flex;gap:10px;margin-top:12px}
    #items .row{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;padding:10px;border-bottom:1px solid #eee}
    .badge{font-size:12px;color:#666}
    .row .ops button{margin-left:6px}
    @media(max-width:1000px){.wrap{grid-template-columns:1fr}.images{grid-template-columns:1fr 1fr} .grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="top">
    <h1>–ê–¥–º—ñ–Ω–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤</h1>
    <div class="actions">
      <input type="file" id="importFile" accept=".json" />
      <button id="btnImport">Import JSON</button>
      <button id="btnExport">Export JSON</button>
    </div>
  </header>

  <main class="wrap">
    <section class="form">
      <h2>–§–æ—Ä–º–∞ —Ç–æ–≤–∞—Ä—É</h2>
      <div class="grid">
        <label>ID <input id="id" placeholder="kovi-adt-300-enduro" /></label>
        <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è
          <select id="category">
            <option>–ú–æ—Ç–æ</option>
            <option>–ê–≥—Ä–æ</option>
            <option>–í–µ–ª–æ</option>
            <option>–ï–ª–µ–∫—Ç—Ä–æ</option>
          </select>
        </label>
        <label>–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è (–¥–ª—è –ú–æ—Ç–æ)
          <select id="subcategory">
            <option value="">‚Äî</option>
            <option>–ï–Ω–¥—É—Ä–æ</option>
            <option>–ü—ñ—Ç–±–∞–π–∫</option>
            <option>–î–æ—Ä–æ–∂–Ω—ñ</option>
            <option>–°–∫—É—Ç–µ—Ä–∏</option>
          </select>
        </label>
        <label>–¶—ñ–Ω–∞ (–≥—Ä–Ω) <input id="price" type="number" min="0" value="0" /></label>
        <label>–í–∞–ª—é—Ç–∞ <input id="currency" value="–≥—Ä–Ω" /></label>
      </div>

      <h3>–ù–∞–∑–≤–∞</h3>
      <div class="grid">
        <label>UA <input id="name_ua" placeholder="–ù–∞–∑–≤–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é" /></label>
        <label>EN <input id="name_en" placeholder="Name in English" /></label>
      </div>

      <h3>–û–ø–∏—Å</h3>
      <div class="grid">
        <label>UA <textarea id="desc_ua" rows="3"></textarea></label>
        <label>EN <textarea id="desc_en" rows="3"></textarea></label>
      </div>

      <h3>–§–æ—Ç–æ (—ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤ —É /images)</h3>
      <div class="images">
        <input id="img1" placeholder="images/photo1.jpg" />
        <input id="img2" placeholder="images/photo2.jpg" />
        <input id="img3" placeholder="images/photo3.jpg" />
        <button id="addImg">+ —â–µ</button>
      </div>

      <h3>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
      <div class="specs">
        <div>
          <h4>UA</h4>
          <textarea id="specs_ua" rows="4" placeholder="–ö–ª—é—á: –ó–Ω–∞—á–µ–Ω–Ω—è&#10;–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: 800W"></textarea>
        </div>
        <div>
          <h4>EN</h4>
          <textarea id="specs_en" rows="4" placeholder="Key: Value&#10;Power: 800W"></textarea>
        </div>
      </div>

      <h3>–ü–µ—Ä–µ–≤–∞–≥–∏</h3>
      <div class="specs">
        <div>
          <h4>UA</h4>
          <textarea id="benef_ua" rows="3" placeholder="–ü–µ—Ä–µ–≤–∞–≥–∞ 1&#10;–ü–µ—Ä–µ–≤–∞–≥–∞ 2"></textarea>
        </div>
        <div>
          <h4>EN</h4>
          <textarea id="benef_en" rows="3" placeholder="Advantage 1&#10;Advantage 2"></textarea>
        </div>
      </div>

      <div class="btns">
        <button id="btnNew">–û—á–∏—Å—Ç–∏—Ç–∏</button>
        <button id="btnAdd">–î–æ–¥–∞—Ç–∏ / –û–Ω–æ–≤–∏—Ç–∏</button>
      </div>
    </section>

    <section class="list">
      <h2>–¢–æ–≤–∞—Ä–∏</h2>
      <div id="items"></div>
    </section>
  </main>

<script>
let PRODUCTS = [];
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

async function load() {
  try {
    const r = await fetch('data/products.json', {cache:'no-store'});
    PRODUCTS = await r.json();
  } catch (e) {
    PRODUCTS = [];
  }
  renderList();
}
function renderList() {
  const box = $('#items');
  box.innerHTML = '';
  PRODUCTS.forEach(p=>{
    const row = document.createElement('div'); row.className='row';
    row.innerHTML = `
      <div>
        <div><b>${escape(p.name_ua||'‚Äî')}</b></div>
        <div class="badge">${escape(p.category||'')} ${p.subcategory?('‚Ä¢ '+escape(p.subcategory)) : ''}</div>
      </div>
      <div class="ops">
        <button data-id="${p.id}" data-act="edit">‚úèÔ∏è</button>
        <button data-id="${p.id}" data-act="del">üóëÔ∏è</button>
      </div>
      <div class="badge">${p.price? p.price+' '+(p.currency||'–≥—Ä–Ω') : '‚Äî'}</div>
    `;
    box.appendChild(row);
  });
  box.addEventListener('click', onListClick);
}
function onListClick(e){
  const btn = e.target.closest('button'); if(!btn) return;
  const id = btn.getAttribute('data-id');
  const act = btn.getAttribute('data-act');
  const p = PRODUCTS.find(x=> String(x.id)===String(id));
  if(!p) return;
  if(act==='edit') fillForm(p);
  if(act==='del'){ if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä?')){ PRODUCTS = PRODUCTS.filter(x=> String(x.id)!==String(id)); renderList(); } }
}

function fillForm(p){
  $('#id').value = p.id || '';
  $('#category').value = p.category || '–ú–æ—Ç–æ';
  $('#subcategory').value = p.subcategory || '';
  $('#price').value = p.price || 0;
  $('#currency').value = p.currency || '–≥—Ä–Ω';
  $('#name_ua').value = p.name_ua || '';
  $('#name_en').value = p.name_en || '';
  $('#desc_ua').value = p.description_ua || '';
  $('#desc_en').value = p.description_en || '';

  const imgs = p.images || [];
  const imgInputs = $$('.images input');
  imgInputs.forEach((inp,i)=> inp.value = imgs[i] || '');
}

function readForm(){
  const id = $('#id').value.trim();
  if(!id) { alert('ID –æ–±–æ–≤ º—è–∑–∫–æ–≤–∏–π'); throw new Error('no id'); }
  const images = $$('.images input').map(i=> i.value.trim()).filter(Boolean);

  return {
    id,
    category: $('#category').value,
    subcategory: $('#subcategory').value,
    price: Number($('#price').value || 0),
    currency: $('#currency').value.trim() || '–≥—Ä–Ω',
    name_ua: $('#name_ua').value.trim(),
    name_en: $('#name_en').value.trim(),
    description_ua: $('#desc_ua').value.trim(),
    description_en: $('#desc_en').value.trim(),
    images,
    specs: {
      ua: parsePairs($('#specs_ua').value),
      en: parsePairs($('#specs_en').value)
    },
    benefits: {
      ua: parseList($('#benef_ua').value),
      en: parseList($('#benef_en').value)
    }
  };
}
function parsePairs(txt){
  return txt.split('\n').map(l=>l.trim()).filter(Boolean).map(l=>{
    const i = l.indexOf(':');
    if(i<0) return [l, ''];
    return [l.slice(0,i).trim(), l.slice(i+1).trim()];
  });
}
function parseList(txt){ return txt.split('\n').map(l=>l.trim()).filter(Boolean); }
function escape(s=''){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

$('#btnAdd').addEventListener('click', ()=>{
  try{
    const p = readForm();
    const i = PRODUCTS.findIndex(x=> String(x.id)===String(p.id));
    if(i>=0) PRODUCTS[i]=p; else PRODUCTS.push(p);
    renderList();
    alert('–ó–±–µ—Ä–µ–∂–µ–Ω–æ. –¢–µ–ø–µ—Ä –∑—Ä–æ–±–∏ Export JSON.');
  }catch(e){}
});
$('#btnNew').addEventListener('click', ()=>{
  $$('input, textarea').forEach(i=> i.value='');
  $('#currency').value='–≥—Ä–Ω';
});

$('#addImg').addEventListener('click', ()=>{
  const d=document.createElement('input'); d.placeholder='images/photoX.jpg';
  $('.images').insertBefore(d, $('#addImg'));
});

$('#btnExport').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(PRODUCTS, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'products.json';
  a.click();
  URL.revokeObjectURL(a.href);
});

$('#btnImport').addEventListener('click', async ()=>{
  const f = $('#importFile').files[0];
  if(!f) return alert('–û–±–µ—Ä–∏ JSON —Ñ–∞–π–ª');
  const txt = await f.text();
  try{
    const arr = JSON.parse(txt);
    if(!Array.isArray(arr)) throw new Error('not array');
    PRODUCTS = arr;
    renderList();
    alert('–Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ');
  }catch(e){ alert('–§–æ—Ä–º–∞—Ç –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π'); }
});

load();
</script>

</body>
</html>

  

